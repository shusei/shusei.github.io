(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,98471,e=>{"use strict";let t,a,r;var l=e.i(43476),s=e.i(71645),n=e.i(81949),i=e.i(75254);let d=(0,i.default)("file-spreadsheet",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]),o=(0,i.default)("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),c=(0,i.default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),p=(0,i.default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function f(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}var h=Symbol.for("react.lazy"),u=s[" use ".trim().toString()];function y(e){var t;return null!=e&&"object"==typeof e&&"$$typeof"in e&&e.$$typeof===h&&"_payload"in e&&"object"==typeof(t=e._payload)&&null!==t&&"then"in t}var m=((r=s.forwardRef((e,t)=>{let{children:a,...r}=e;if(y(a)&&"function"==typeof u&&(a=u(a._payload)),s.isValidElement(a)){var l;let e,n,i=(l=a,(n=(e=Object.getOwnPropertyDescriptor(l.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?l.ref:(n=(e=Object.getOwnPropertyDescriptor(l,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?l.props.ref:l.props.ref||l.ref),d=function(e,t){let a={...t};for(let r in t){let l=e[r],s=t[r];/^on[A-Z]/.test(r)?l&&s?a[r]=(...e)=>{let t=s(...e);return l(...e),t}:l&&(a[r]=l):"style"===r?a[r]={...l,...s}:"className"===r&&(a[r]=[l,s].filter(Boolean).join(" "))}return{...e,...a}}(r,a.props);return a.type!==s.Fragment&&(d.ref=t?function(...e){return t=>{let a=!1,r=e.map(e=>{let r=f(e,t);return a||"function"!=typeof r||(a=!0),r});if(a)return()=>{for(let t=0;t<r.length;t++){let a=r[t];"function"==typeof a?a():f(e[t],null)}}}}(t,i):i),s.cloneElement(a,d)}return s.Children.count(a)>1?s.Children.only(null):null})).displayName="Slot.SlotClone",t=r,(a=s.forwardRef((e,a)=>{let{children:r,...n}=e;y(r)&&"function"==typeof u&&(r=u(r._payload));let i=s.Children.toArray(r),d=i.find(x);if(d){let e=d.props.children,r=i.map(t=>t!==d?t:s.Children.count(e)>1?s.Children.only(null):s.isValidElement(e)?e.props.children:null);return(0,l.jsx)(t,{...n,ref:a,children:s.isValidElement(e)?s.cloneElement(e,void 0,r):null})}return(0,l.jsx)(t,{...n,ref:a,children:r})})).displayName="Slot.Slot",a),b=Symbol("radix.slottable");function x(e){return s.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===b}var g=e.i(25913),j=e.i(75157);let v=(0,g.cva)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),C=s.forwardRef(({className:e,variant:t,size:a,asChild:r=!1,...s},n)=>(0,l.jsx)(r?m:"button",{className:(0,j.cn)(v({variant:t,size:a,className:e})),ref:n,...s}));C.displayName="Button";var k=e.i(15288),T=e.i(46696),w=e.i(84774),N=e.i(87486);function S(){let[e,t]=(0,s.useState)(null),[a,r]=(0,s.useState)(null),[i,f]=(0,s.useState)(null),[h,u]=(0,s.useState)(!1),[y,m]=(0,s.useState)(!1),b=async()=>{if(!e)return;u(!0),r(null),f(null);let t=new FormData;t.append("file",e),t.append("user_id","b8b8984a-0782-4e36-b5ad-ce42ae297d1b");try{if(e.name.endsWith(".csv")){let e=await n.default.post("http://localhost:3002/api/import/analyze",t,{headers:{"Content-Type":"multipart/form-data"}});r(e.data.suggestion),T.toast.success("CSV 分析完成",{description:"AI 已自動對應欄位"})}else if(e.name.endsWith(".pdf")){let e=await n.default.post("http://localhost:3002/api/import/pdf",t,{headers:{"Content-Type":"multipart/form-data"}});f(e.data.transactions),T.toast.success("PDF 分析完成",{description:`共找到 ${e.data.transactions.length} 筆交易`})}else T.toast.error("不支援的檔案格式")}catch(e){console.error(e),T.toast.error("分析失敗",{description:"請確認檔案格式"})}finally{u(!1)}},x=async()=>{if(!e||!a)return;m(!0);let l=new FormData;l.append("file",e),l.append("user_id","b8b8984a-0782-4e36-b5ad-ce42ae297d1b"),l.append("mapping",JSON.stringify(a));try{await n.default.post("http://localhost:3002/api/import/start",l,{headers:{"Content-Type":"multipart/form-data"}}),T.toast.success("匯入任務已開始",{description:"系統將在背景處理您的檔案"}),t(null),r(null)}catch(e){console.error(e),T.toast.error("匯入失敗")}finally{m(!1)}},g=async()=>{if(i){m(!0);try{let e=0;for(let t of i)try{await n.default.post("http://localhost:3002/api/transactions",{user_id:"b8b8984a-0782-4e36-b5ad-ce42ae297d1b",...t}),e++}catch(e){console.error("Failed to save tx",t,e)}T.toast.success("匯入完成",{description:`成功儲存 ${e} 筆交易`}),t(null),f(null)}catch(e){console.error(e),T.toast.error("儲存失敗")}finally{m(!1)}}};return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"智慧匯入"}),(0,l.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,l.jsxs)(k.Card,{children:[(0,l.jsx)(k.CardHeader,{children:(0,l.jsx)(k.CardTitle,{children:"1. 上傳檔案 (CSV / PDF)"})}),(0,l.jsxs)(k.CardContent,{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"border-2 border-dashed border-slate-200 rounded-lg p-10 flex flex-col items-center justify-center text-center hover:bg-slate-50 transition",children:[e&&e.name.endsWith(".pdf")?(0,l.jsx)(o,{className:"w-10 h-10 text-red-500 mb-4"}):(0,l.jsx)(d,{className:"w-10 h-10 text-green-500 mb-4"}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"支援銀行對帳單 (CSV) 或電子帳單 (PDF)"}),(0,l.jsx)("input",{type:"file",accept:".csv,.pdf",onChange:e=>{e.target.files&&e.target.files[0]&&(t(e.target.files[0]),r(null),f(null))},className:"block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-sky-50 file:text-sky-700 hover:file:bg-sky-100"})]}),e&&(0,l.jsx)(C,{onClick:b,disabled:h,className:"w-full",children:h?"AI 分析中...":"開始分析"})]})]}),a&&(0,l.jsxs)(k.Card,{className:"border-sky-200 bg-sky-50/30",children:[(0,l.jsx)(k.CardHeader,{children:(0,l.jsxs)(k.CardTitle,{className:"flex items-center text-sky-700",children:[(0,l.jsx)(c,{className:"w-5 h-5 mr-2"}),"2. 確認 CSV 欄位"]})}),(0,l.jsxs)(k.CardContent,{className:"space-y-4",children:[(0,l.jsxs)(w.Table,{children:[(0,l.jsx)(w.TableHeader,{children:(0,l.jsxs)(w.TableRow,{children:[(0,l.jsx)(w.TableHead,{children:"系統欄位"}),(0,l.jsx)(w.TableHead,{children:"CSV 欄位 (AI 建議)"})]})}),(0,l.jsx)(w.TableBody,{children:Object.entries(a).map(([e,t])=>(0,l.jsxs)(w.TableRow,{children:[(0,l.jsx)(w.TableCell,{className:"font-medium capitalize",children:e}),(0,l.jsx)(w.TableCell,{children:String(t)})]},e))})]}),(0,l.jsx)(C,{onClick:x,disabled:y,className:"w-full bg-sky-600 hover:bg-sky-700",children:y?"匯入中...":"確認並匯入 CSV"})]})]}),i&&(0,l.jsxs)(k.Card,{className:"border-sky-200 bg-sky-50/30 col-span-2 md:col-span-1",children:[(0,l.jsx)(k.CardHeader,{children:(0,l.jsxs)(k.CardTitle,{className:"flex items-center text-sky-700",children:[(0,l.jsx)(c,{className:"w-5 h-5 mr-2"}),"2. 確認 PDF 交易內容"]})}),(0,l.jsxs)(k.CardContent,{className:"space-y-4",children:[(0,l.jsx)("div",{className:"max-h-[400px] overflow-y-auto",children:(0,l.jsxs)(w.Table,{children:[(0,l.jsx)(w.TableHeader,{children:(0,l.jsxs)(w.TableRow,{children:[(0,l.jsx)(w.TableHead,{children:"日期"}),(0,l.jsx)(w.TableHead,{children:"描述"}),(0,l.jsx)(w.TableHead,{children:"金額"}),(0,l.jsx)(w.TableHead,{children:"分類"})]})}),(0,l.jsx)(w.TableBody,{children:i.map((e,t)=>(0,l.jsxs)(w.TableRow,{children:[(0,l.jsx)(w.TableCell,{children:e.date}),(0,l.jsx)(w.TableCell,{children:e.description}),(0,l.jsx)(w.TableCell,{className:"income"===e.type?"text-green-600":"text-red-600",children:e.amount}),(0,l.jsx)(w.TableCell,{children:(0,l.jsx)(N.Badge,{variant:"outline",children:e.category})})]},t))})]})}),(0,l.jsxs)(C,{onClick:g,disabled:y,className:"w-full bg-sky-600 hover:bg-sky-700",children:[(0,l.jsx)(p,{className:"w-4 h-4 mr-2"}),y?"儲存中...":`確認並儲存 (${i.length} 筆)`]})]})]})]})]})}e.s(["default",()=>S],98471)}]);